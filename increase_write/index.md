# MySQLå†™å…¥é€Ÿåº¦è°ƒä¼˜ä¹‹`innodb_flush_log_at_trx_commit`


<!--more-->



ä¹‹å‰é¡¹ç›®é‡Œä¸€ç›´åœ¨ç”¨çš„ SeaTunnel ç‰ˆæœ¬æ˜¯ 2.1.3, æœ‰äº›æ—§äº†. è€Œä¸” Spark å’Œ Flink çš„è„šæœ¬è¿˜è¦å†™ä¸¤å¥—. æ‰€ä»¥å°±åœ¨è€ƒè™‘è¦å‡çº§åˆ° v2.3.2. æ‰€ä»¥æœ€è¿‘åœ¨åš  SeaTunnel v2.3.2 çš„æ€§èƒ½è°ƒç ”. 



ä¹‹å‰åš v2.3.0 çš„è°ƒç ”çš„æ—¶å€™å°±å‘çŽ°åœ¨å†™å…¥ MySQL çš„æ—¶å€™æ€§èƒ½ç‰¹åˆ«ä½Ž, å†™å…¥é€Ÿåº¦ç«Ÿç„¶ 200/s. æœ‰äº›ä¸èƒ½æŽ¥å—... å› ä¸º v2.1.3 å†™å…¥ MySQL çš„é€Ÿåº¦å¯ä»¥è¾¾åˆ° 2000+/s. ä½†æ˜¯å½“æ—¶ä¹Ÿæ²¡æœ‰æ·±ç©¶è¿™ä¸ªé—®é¢˜, å°±æç½®äº†. æœ€è¿‘è¿™ä¸ªé—®é¢˜åˆè¢«æèµ·çš„æ—¶å€™, å°±å†æ¬¡åŽ»ç¤¾åŒºæ‰¾æ‰¾çœ‹æœ‰æ²¡æœ‰ç±»ä¼¼çš„é—®é¢˜. ç„¶åŽå‘çŽ°äº†ä¹Ÿæœ‰äººé¢ä¸´ç€è¿™ä¸ªé—®é¢˜: [issue](https://github.com/apache/seatunnel/issues/4658). é‡Œé¢æå‡ºåœ¨é“¾æŽ¥ URI åŽé¢åŠ ä¸Šå‚æ•° `rewriteBatchStatements=true`. ä½†æ˜¯è¿™ä¸ªå‚æ•°åœ¨è¿™é‡Œçš„æé«˜çš„å¹¶ä¸æ˜Žæ˜¾.. 

> æˆ‘ç”šè‡³è§‰å¾—è¿™é‡Œå¢žåŠ è¿™ä¸ªå‚æ•°ä¹‹åŽ, å…¶å®žå¹¶æ²¡æœ‰æå‡. ðŸ˜‚
>
> è¿™ä¸ªå‚æ•°çš„æ„ä¹‰æ˜¯æ•°æ®åº“ä¼šæ›´é«˜æ€§èƒ½çš„æ‰§è¡Œæ‰¹é‡å¤„ç†. 



å½“å†™å…¥çš„æ—¶å€™, å†åŽ»æŸ¥çœ‹æœåŠ¡å™¨çš„æ—¶å€™å‘çŽ°, ç¡¬ç›˜çš„ IO æœ‰æ˜Žæ˜¾çš„å¢žé«˜. äºŽæ˜¯å°±çŒœæƒ³, æ˜¯ä¸æ˜¯ v2.3.2 ç‰ˆæœ¬é‡Œ, å†™å…¥çš„æ—¶å€™, æ¯æ¡éƒ½ä½œä¸ºä¸€ä¸ªäº‹åŠ¡æäº¤çš„, ç„¶åŽå°±æƒ³åˆ°äº† `innodb_flush_log_at_trx_commit` è¿™ä¸ªå‚æ•°, åœ¨è¡¥å……è¿™éƒ¨åˆ†çš„çŸ¥è¯†çš„æ—¶å€™, å‘çŽ°äº†ä¹Ÿå¯ä»¥è°ƒæ•´ä¸€ä¸‹ç›¸å…³çš„å‚æ•°`sync_binlog` ä»¥è¾¾åˆ°è°ƒä¼˜çš„ç›®çš„. 



äºŽæ˜¯å°±æœ‰äº†è¿™ç¯‡åšå®¢è®°å½•ä¸€ä¸‹. 



## `innodb_flush_log_at_trx_commit`

è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥é…ç½® MySQL æ—¥å¿—ä½•æ—¶å†™å…¥ç¡¬ç›˜çš„å‚æ•°. 



æŸ¥çœ‹ MySQL é…ç½®: 

```sql
SHOW VARIABLES LIKE 'innodb_flush_log_at_trx_commit';
```



* `0`: æ—¥å¿—ç¼“å­˜åŒºå°†æ¯éš” 1 ç§’å†™åˆ°æ—¥å¿—ä¸­, å¹¶ä¸”å°†æ—¥å¿—æ–‡ä»¶çš„æ•°æ®åˆ·æ–° (flush) åˆ°ç£ç›˜ä¸Š. è¯¥æ¨¡å¼ä¸‹åœ¨äº‹åŠ¡æäº¤æ—¶ä¸ä¼šä¸»åŠ¨è§¦å‘å†™å…¥ç£ç›˜çš„æ“ä½œ. 
* `1`: æ¯æ¬¡æäº¤äº‹åŠ¡æ—¶, MySQL éƒ½ä¼šæŠŠæ—¥å¿—æ–‡ä»¶çš„æ•°æ®å†™å…¥, å¹¶ä¸”åˆ·æ–°åˆ°ç£ç›˜ä¸Š, é»˜è®¤ä¸ºè¯¥æ¨¡å¼.
* `2`: æ¯æ¬¡æäº¤äº‹åŠ¡æ—¶, MySQL éƒ½ä¼šæŠŠæ—¥å¿—æ–‡ä»¶çš„æ•°æ®å†™å…¥, ä½†æ˜¯åˆ·æ–°åˆ°ç£ç›˜çš„æ“ä½œä¸ä¼šåŒæ—¶è¿›è¡Œ, è€Œæ˜¯æ¯ç§’æ‰§è¡Œä¸€æ¬¡åˆ·æ–°åˆ°ç£ç›˜çš„æ“ä½œ. 

> æ‰€ä»¥è¯´:
>
> * å½“è®¾ç½®ä¸º `0` çš„æ—¶å€™, é€Ÿåº¦æœ€å¿«, ä½†æ˜¯ä¸å®‰å…¨, `mysqld` è¿›ç¨‹çš„å´©æºƒä¼šå¯¼è‡´ä¸Šä¸€ç§’æ‰€æœ‰äº‹åŠ¡æ•°æ®çš„ä¸¢å¤±.
>
> * å½“è®¾ç½®ä¸º `1` çš„æ—¶å€™, é€Ÿåº¦æœ€æ…¢, ä½†æ˜¯æœ€å®‰å…¨. åœ¨ `mysqld` æœåŠ¡å´©æºƒæˆ–æœåŠ¡å™¨å´©æºƒçš„æƒ…å†µä¸‹, æ—¥å¿—åªå¯èƒ½ä¸¢å¤±æœ€å¤šä¸€ä¸ªè¯­å¥æˆ–ä¸€ä¸ªäº‹åŠ¡. 
>
> * å½“è®¾ç½®ä¸º `2` çš„æ—¶å€™, é€Ÿåº¦å¿«, ä¹Ÿæ¯”è®¾ç½®ä¸º `0` æ—¶å®‰å…¨, åªæœ‰åœ¨æ“ä½œç³»ç»Ÿå´©æºƒæˆ–ç³»ç»Ÿæ–­ç”µçš„æƒ…å†µä¸‹, ä¸Šä¸€ç§’æ‰€æœ‰äº‹åŠ¡æ•°æ®æ‰å¯èƒ½ä¸¢å¤±. æ‰€ä»¥æˆ‘å°† MySQL æ”¹æˆè¯¥æ¨¡å¼. 



## `sync_binlog`

é»˜è®¤æƒ…å†µä¸‹, å¹¶ä¸æ˜¯æ¯æ¬¡å†™å…¥æ—¶éƒ½å°† binlog æ—¥å¿—æ–‡ä»¶ä¸Žç£ç›˜åŒæ­¥. å› æ­¤å¦‚æžœæ“ä½œç³»ç»Ÿæˆ–æœåŠ¡å™¨å´©æºƒ. æœ‰å¯èƒ½ binlog ä¸­æœ€åŽçš„è¯­å¥ä¸¢å¤±. 

ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µ, å¯ä»¥ä½¿ç”¨ `sync_binlog` å…¨å±€å˜é‡ (`1` æ˜¯æœ€å®‰å…¨çš„å€¼, ä½†ä¹Ÿæ˜¯æœ€æ…¢çš„), ä½¿ binlog åœ¨æ¯ N æ¬¡ binlog æ—¥å¿—æ–‡ä»¶å†™å…¥åŽä¸Žç£ç›˜åŒæ­¥. 



æŸ¥çœ‹ MySQL é…ç½®: 

```sql
SHOW VARIABLES LIKE 'sync_binlog';
```



æ‰€ä»¥æœ€ç»ˆ, æˆ‘å°† `innodb_flush_log_at_trx_commit` è®¾ç½®ä¸º `2`, `sync_binlog` è®¾ç½®ä¸º `100` . ç„¶åŽç»è¿‡æµ‹è¯•, v2.3.2 å¯¹äºŽ MySQL çš„å†™å…¥é€Ÿåº¦è¾¾åˆ°äº† 2000+/s çš„é€Ÿåº¦. ðŸ˜„


---

> ä½œè€…:   
> URL: https://buli-home.cn/increase_write/  

